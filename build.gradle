defaultTasks 'full'

ext { documentBase = 'resume' }

project.ext {
  latexFile = documentBase + '.tex'
  pdfFile = documentBase + '.pdf'
  rawDirectory = 'raw'
  cookedDirectory = 'cooked'
}

task pdflatex1(type: Exec) {
  outputs.upToDateWhen{false}
  workingDir project.rawDirectory 
  standardOutput = new ByteArrayOutputStream() // stops output to STDOUT

  commandLine 'pdflatex', project.documentBase
}

task pdflatex2(type: Exec) {
  outputs.upToDateWhen{false}
  workingDir project.rawDirectory 
  standardOutput = new ByteArrayOutputStream() // stops output to STDOUT

  commandLine 'pdflatex', project.documentBase
}

task cook() {
  dependsOn pdflatex1, pdflatex2
  doFirst {
    println "Cooking $project.latexFile in /$project.rawDirectory."
  }


  outputs.file file("$project.rawDirectory/$project.pdfFile")

  doLast {
    println "Cooked $project.latexFile to $project.pdfFile."
  }
}

task deliver(type: Copy) {
  outputs.upToDateWhen{false}

  from cook
  into project.cookedDirectory

  doLast {
    println "Delivered $project.pdfFile to /$project.cookedDirectory."
  }
}

task flush(type: Delete) {
  dependsOn deliver
  outputs.upToDateWhen{false}

  delete {
    fileTree(dir: project.rawDirectory, excludes: ['**/*.tex', '**/*.cls'])
  } 

  doLast {
    println "Flushed /$project.rawDirectory of temporary $documentBase files."
  }
}

task full {
  dependsOn flush
}
